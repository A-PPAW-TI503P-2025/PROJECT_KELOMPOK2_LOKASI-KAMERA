@startuml

title Flowchart Sistem Peminjaman (Final: Admin Validasi + Logic Baru)

start

:Buka Aplikasi Website;

'--- ALUR REGISTER ---
if (Sudah Punya Akun?) then (Tidak)
  :Menu Register;
  repeat
    :Input Name, NIM, Email, Password;
    if (Validasi: Email/NIM ada?) then (Ya/Error)
      :Alert "Akun sudah terdaftar";
    else (Tidak)
      break
    endif
  repeat while
  :Simpan Data Akun;
else (Ya)
endif

'--- ALUR LOGIN (AUTO LOOP) ---
:Menu Login;
repeat
  :Input Email & Password;
  :Cek Kredensial (Validasi);
  if (Kredensial Valid?) then (Ya)
    break
  else (Tidak)
    :Alert "Email/Password Salah";
  endif
repeat while

:Ambil Data User & Role;

'--- PERCABANGAN ROLE ---
if (Apakah Role == Admin?) then (Ya)
  
  '=== DASHBOARD ADMIN ===
  partition "Dashboard Admin" {
    :Masuk Dashboard Admin;
    repeat
      :Pilih Menu (Navbar);
      
      if (Menu == Kelola Buku?) then (Ya)
        :Tampilkan Daftar Buku;
        :Lakukan CRUD (Tambah/Edit/Hapus);
        :Update Database Buku;
      
      '--- TAMBAHAN: VALIDASI BUKTI ---
      elseif (Menu == Laporan Peminjaman?) then (Ya)
        :Lihat Tabel Laporan;
        :Cek Detail Peminjaman;
        :Validasi Bukti Foto & Lokasi User; 
        ' (Ini langkah tambahan yang kamu minta)
        
      elseif (Menu == Logout?) then (Ya)
        break
      endif
    repeat while (Kembali ke Menu)
  }

else (Tidak / Member)

  '=== DASHBOARD PEMINJAM ===
  partition "Dashboard Peminjam" {
    :Masuk Dashboard Peminjam;
    repeat
      :Pilih Menu (Navbar);
      
      '--- FITUR 1: PINJAM BUKU ---
      if (Menu == Pinjam Buku?) then (Ya)
        :Cari & Pilih Buku;
        if (Stok Tersedia?) then (Tidak)
          :Tampilkan Alert "Stok Habis";
        else (Ya)
          :Klik Tombol "Pinjam";
          ' Logic: Kamera -> Foto & Lokasi
          :Sistem Buka Kamera;
          :User Ambil Foto Selfie (Bukti);
          :Sistem Auto-Detect Lokasi User (GPS);
          :Simpan Data Transaksi;
          :Kurangi Stok Buku (-1);
          :Tampilkan "Berhasil Pinjam";
        endif

      '--- FITUR 2: KEMBALIKAN BUKU ---
      elseif (Menu == Kembalikan Buku?) then (Ya)
        :Pilih Buku di "Peminjaman Saya";
        :Klik Tombol "Kembalikan";
        ' Logic: Kamera -> Foto & Lokasi
        :Sistem Buka Kamera;
        :User Ambil Foto Kondisi Buku;
        :Sistem Auto-Detect Lokasi User (GPS);
        :Update Status "Dikembalikan";
        :Tambah Stok Buku (+1);
        :Tampilkan "Berhasil Kembali";

      '--- FITUR 3: LIHAT RIWAYAT ---
      elseif (Menu == Lihat Riwayat?) then (Ya)
        :Tampilkan List Riwayat Peminjaman;
      
      '--- FITUR 4: LOGOUT ---
      elseif (Menu == Logout?) then (Ya)
        break
      endif
      
    repeat while (Kembali ke Menu)
  }

endif

'--- ENDING ---
:Logout Akun;
stop

@enduml